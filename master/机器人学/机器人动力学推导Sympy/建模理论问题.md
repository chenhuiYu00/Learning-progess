# 建模理论问题



## 系统稳定点和lqr控制

- 当我对一个平衡车进行建模并应用了lqr控制后，它怎么知道它在站立时是平衡的，或者说为什么模型站立时是平衡的？

```c
在进行平衡车的建模时，需要将系统状态、输入和输出进行定义。其中，状态可以包括车身倾角、车身角速度、轮子转速等参数；输入可以包括电机扭矩、车轮的旋转角度等参数；输出可以包括车身倾角、车身角速度、车速等参数。然后，根据这些参数，可以建立平衡车的状态空间模型。

在使用LQR控制时，需要将系统的状态空间模型转化为矩阵形式，并进行矩阵计算。通过优化LQR控制器中的权重矩阵，可以得到一个控制器，使得系统的状态可以在某些条件下达到最优状态。

对于平衡车来说，在没有外力干扰的情况下，系统的最优状态就是平衡状态。在建立平衡车模型时，通常会将车身的重心设置在车轮轴线上方，以使得车身在不受外力干扰时可以平衡地停留在两个车轮上。在这种情况下，平衡车的状态空间模型的平衡点就是车身倾角为0、车身角速度为0、车轮转速为0的状态。如果车辆状态偏离了平衡点，控制器将会产生一个反馈作用，以使车辆回到平衡状态。

因此，LQR控制器通过测量平衡车的状态信息（如倾角、角速度等）以及对状态进行反馈控制，来保持平衡车在平衡点上。也就是说，控制器通过不断地测量车身状态来检测车辆是否处于平衡状态，如果不在平衡状态，则进行调整，使车辆回到平衡点。因此，在建立平衡车模型并应用LQR控制器时，需要考虑到车辆的初始状态，以便控制器能够将车辆带回到平衡点上。
```



- **平衡车是倒下的话速度也是为0，那平衡车为什么会立起来维持速度为0而不是直接倒下来让速度为0？**

```c
平衡车立起来维持速度为0是因为在lqr控制的过程中，控制器会计算出一个控制量来让车维持在倒立的位置，这个控制量会根据车身的倾斜角度、角速度等状态信息动态地调整，使得车辆能够保持平衡。

具体来说，当平衡车倾斜时，控制器会通过调整电机的输出控制车轮的转速来产生一个力矩，这个力矩会抵消倾斜产生的重力分量(，从而让车辆维持在倒立的位置。当倾斜角度或角速度发生变化时，控制器会重新计算控制量，从而调整电机的输出，使得车辆能够及时地响应外部干扰并保持平衡。

因此，即使平衡车倒下来，控制器仍然会通过调整电机输出来尝试维持平衡。但是，如果车辆已经倒下得太远，或者外部干扰太强，那么控制器可能就无法维持平衡了，车辆就会倒下。
```



- 为什么需要一个力矩会抵消倾斜产生的重力分量？

```c
在一个平衡系统中，例如倒立摆，重力会产生一个向下的力矩，使得摆杆倾斜。因此，如果要维持摆杆的竖直位置，就需要在摆杆倾斜的方向上产生一个与重力相反的力矩，这样才能抵消重力的影响，使得摆杆可以维持在竖直位置上。这个力矩可以通过在摆杆下部施加一个水平方向的力来实现。在平衡车中，也是通过产生一个与倾斜方向相反的力矩，来抵消倾斜产生的重力分量，从而维持平衡。
```

> 具体原因追溯到我们建模时的考虑的东西，建模时我们并没有考虑“地面”会对车体产生的反作用力。这也是一个约束力，不过在建模时通常不会考虑。那么在模型角度看来车体受到的重力分量会让它一直运动(因为没有“地面”阻挡),为了消除这个分量的影响需要一个力矩会抵消倾斜产生的重力分量。此时回到上一个问题，当重力分量消除后小车就是立起来的状态。



- 系统的稳定点是所有状态向量为0的点吗？

```c
对于一个平衡车，LQR控制器不一定只能找到车身倾角为0、车身角速度为0、车轮转速为0这些平衡点，这些平衡点只是一些比较常见的、相对容易找到的平衡点。实际上，LQR控制器可以找到系统的任何一个平衡点，并将系统控制到该平衡点周围的某一工作点。这个工作点可以是非常复杂的，可能包含多个状态变量的不同取值组合。

在对平衡车进行建模时，通常会假设车身在平衡点周围的摆动可以看作是线性的，然后使用线性控制理论（如LQR控制器）来设计控制器。这样设计出的控制器能够保证车身在平衡点周围的摆动不会变得越来越大，从而保证平衡车能够保持稳定的姿态。而在实际应用中，由于各种因素的影响，平衡车的实际平衡点可能会有所偏移，但只要偏移不太大，LQR控制器仍然能够将平衡车控制到平衡点周围的某一工作点，从而实现稳定运行。
```



- 什么是系统的平衡点？

```c
在控制理论中，系统的平衡点是指系统在某个状态下，各个状态变量都不再发生变化，系统处于静态平衡的状态。在这种状态下，系统的输入与输出都保持不变，系统不需要进行控制，也不需要消耗能量来维持平衡。

对于一个动态系统，平衡点通常是指状态空间中的一个点，满足在该点附近，系统的状态不再发生变化，即状态变量的变化率为零。在控制设计中，可以通过将系统的动态方程进行线性化，然后解出平衡点的位置，从而设计控制器来维持系统在该平衡点附近的稳定运行。在实际应用中，由于各种因素的影响，系统的平衡点可能会有所偏移，因此需要针对具体的系统进行实验和调试，以确定实际的平衡点位置。
```



- **平衡点是我们去发命令还是lqr会自动找到？**

```c
LQR控制器会自动寻找系统的平衡点，无需手动指定。通常情况下，平衡点是通过对系统动态方程求解使其状态稳定在一个不变的点，即状态不随时间变化，输入为零。对于倒立摆，可以将其放置在倒立位置，让其自行达到平衡状态，记录此时的状态作为平衡点。在实际应用中，也可以通过传感器获取当前系统的状态，找到最接近平衡状态的点作为平衡点。
```

> 假如我们需要平衡车以一个速度向前移动，那么我们需要把速度期望dx设置为相应速度并填入lqr的期望矩阵。在lqr不断的作用中系统的各个执行器最后会趋向于输出一组稳定的力矩来让机器人以一个稳定的姿态向前移动。此时这个姿态会有对应的状态矩阵，此时系统就位于一个平衡点。



- 应用lqr控制是不是也可以让倒立摆45度倾斜保持平衡？

```c
是的，LQR控制器可以用于控制倒立摆在非垂直状态下保持平衡。
    
需要注意的是，在非垂直状态下，系统的动态特性和垂直状态下不同，可能需要更复杂的控制策略才能实现稳定控制。此外，在实际应用中，还需要考虑机械结构、传感器精度等因素对系统的影响。
```



- 倒立摆使用摆杆的位置和速度作为状态变量和使用倾斜角度和倾斜角速度作为状态变量有什么区别？

```c
对于倒立摆，如果我们选择直接使用摆杆的位置和速度作为状态变量，那么在倒立时，这两个状态变量的值都无法区分到底是在上面还是在下面，因此无法准确描述系统的状态。为了避免这种问题，可以选择使用倾斜角度和倾斜角速度作为状态变量，这样无论是在上面还是在下面，这两个状态变量的值都是不同的，可以更准确地描述系统的状态。
```



- lqr的使用是不是需要提供状态向量和期望的状态？

```c
是的，使用LQR控制需要提供状态向量和期望状态。状态向量是系统状态的表示，通常由多个状态变量组成。期望状态是期望使系统收敛到的状态，通常也由多个状态变量组成。在LQR控制中，我们通过调整状态反馈增益矩阵来实现期望状态与实际状态的匹配，从而达到控制系统稳定的目的。因此，在使用LQR控制时，需要对系统状态进行建模，并根据期望的控制目标来定义期望状态。
```



