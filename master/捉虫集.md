# 捉虫集

## GimbalChassis UI获取joint state数据报错

> 这是一个老问题，joint state controller会发布/joint_state话题，而我需要这个话题的数据，而当我首次访问这个数据的数组的时，便会core dump。

最后的解决方法:在访问数组前判断是否为空

```c
if(joint_state[])
    ui.update(joint_state[])  //大概是这样而以
```







## 裁判系统头帧数据显示长度异常

> 对于rm_referee出现的裁判系统数据长度有时会达到万级别，而导致在循环中访问数万次而core dump的情况，我采集了manual与referee的数据



### rm_manual

> manual也有解包相关方面，不过它的数据长度获取的数据都是正常的，稳定输出的
>
> 不过根据其他人的测试，似乎由于静电原因，会导致帧数据改变，所以manual也会崩。这也可能是referee崩的原因。

```c
manual:
          /rm_manual: [Referee::unpack]: data_length: 16
          /rm_manual: [Referee::unpack]: data_length: 16
          /rm_manual: [Referee::unpack]: data_length: 16
          /rm_manual: [Referee::unpack]: data_length: 16
          /rm_manual: [Referee::unpack]: data_length: 16
          /rm_manual: [Referee::unpack]: data_length: 16
          /rm_manual: [Referee::unpack]: data_length: 16
          /rm_manual: [Referee::unpack]: data_length: 16
          /rm_manual: [Referee::unpack]: data_length: 16
          /rm_manual: [Referee::unpack]: data_length: 16
          /rm_manual: [Referee::unpack]: data_length: 16
          /rm_manual: [Referee::unpack]: data_length: 16
          /rm_manual: [Referee::unpack]: data_length: 16
          /rm_manual: [Referee::unpack]: data_length: 27
          /rm_manual: [Referee::unpack]: data_length: 16
          /rm_manual: [Referee::unpack]: data_length: 16
          /rm_manual: [Referee::unpack]: data_length: 27
          /rm_manual: [Referee::unpack]: data_length: 16
          /rm_manual: [Referee::unpack]: data_length: 27
          /rm_manual: [Referee::unpack]: data_length: 16
          /rm_manual: [Referee::unpack]: data_length: 16
          /rm_manual: [Referee::unpack]: data_length: 27
          /rm_manual: [Referee::unpack]: data_length: 16
          /rm_manual: [Referee::unpack]: data_length: 16
          /rm_manual: [Referee::unpack]: data_length: 27
          /rm_manual: [Referee::unpack]: data_length: 16
          /rm_manual: [Referee::unpack]: data_length: 16
          /rm_manual: [Referee::unpack]: data_length: 27
          /rm_manual: [Referee::unpack]: data_length: 16
          /rm_manual: [Referee::unpack]: data_length: 27
          /rm_manual: [Referee::unpack]: data_length: 16
          /rm_manual: [Referee::unpack]: data_length: 16
[rosmon]: Shutting down...
          /rm_manual: /rm_manual exited with status 0
  /odom_tf_publisher: /odom_tf_publisher exited with status 0
  总共测试了20多分钟，运行正常
```



  

### rm_referee

#### 第一次简单测试

```c
  referee:
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 27
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 27
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 27
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 27
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 27
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 27
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::read]: Port exception before read
         /rm_referee: [Referee::unpack]: data length: 6
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 27
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 27
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 27
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 6
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 6
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 15239
         /rm_referee: /rm_referee died from signal 11
         /rm_referee: /rm_referee left a core dump
         /rm_referee: Determined pattern '/tmp/rosmon-node-RDg1xG/core'
         /rm_referee: Could not find a matching core file :-(
```



#### 带入不同频率测试

##### 40HZ

```c

         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 6
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 6
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 27
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 27
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 27
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 6
         /rm_referee: [Referee::unpack]: data length: 42242
         /rm_referee: /rm_referee died from signal 11
         /rm_referee: /rm_referee left a core dump
         /rm_referee: Determined pattern '/tmp/rosmon-node-TjqJIl/core'
         /rm_referee: Could not find a matching core file :-(

```





##### 50HZ

```c

         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 27
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 27
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 4
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 15092
         /rm_referee: /rm_referee died from signal 11
         /rm_referee: /rm_referee left a core dump
         /rm_referee: Determined pattern '/tmp/rosmon-node-TtGg3c/core'
         /rm_referee: Could not find a matching core file :-(

```



```c
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 6
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 27
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 27
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 27
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 27
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 42242
         /rm_referee: /rm_referee died from signal 11
         /rm_referee: /rm_referee left a core dump
         /rm_referee: Determined pattern '/tmp/rosmon-node-gdLxoJ/core'
         /rm_referee: Could not find a matching core file :-(

```



```c
         /rm_referee: [Referee::read]: Port exception before read
         /rm_referee: [Referee::unpack]: data length: 6
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 27
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 27
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 27
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 6
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 6
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 15239
         /rm_referee: /rm_referee died from signal 11
         /rm_referee: /rm_referee left a core dump
         /rm_referee: Determined pattern '/tmp/rosmon-node-RDg1xG/core'
         /rm_referee: Could not find a matching core file :-(

```



##### 55HZ

```c
         /rm_referee: [Referee::unpack]: data length: 27
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 6
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 6
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 6
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 42264
         /rm_referee: /rm_referee died from signal 11
         /rm_referee: /rm_referee left a core dump
         /rm_referee: Determined pattern '/tmp/rosmon-node-Lm5Twb/core'
         /rm_referee: Could not find a matching core file :-(

```



##### 60HZ

###### 新发现

> 我额外添加了对rx_data的检索，正常情况下，它与data length的数据应该一样

```c
         /rm_referee: [Referee::unpack]: data length: 6, rx_data: 6
         /rm_referee: [Referee::unpack]: data length: 16, rx_data: 16
         /rm_referee: [Referee::unpack]: data length: 6, rx_data: 6
         /rm_referee: [Referee::unpack]: data length: 16, rx_data: 16
         /rm_referee: [Referee::unpack]: data length: 16, rx_data: 16
         /rm_referee: [Referee::unpack]: data length: 16, rx_data: 16
         /rm_referee: [Referee::unpack]: data length: 27, rx_data: 27
         /rm_referee: [Referee::unpack]: data length: 16, rx_data: 16
         /rm_referee: [Referee::unpack]: data length: 16, rx_data: 16
         /rm_referee: [Referee::unpack]: data length: 16, rx_data: 16
         /rm_referee: [Referee::unpack]: data length: 27, rx_data: 27
         /rm_referee: [Referee::unpack]: data length: 16, rx_data: 16
         /rm_referee: [Referee::unpack]: data length: 16, rx_data: 16
         /rm_referee: [Referee::unpack]: data length: 16, rx_data: 16
         /rm_referee: [Referee::unpack]: data length: 56587, rx_data: 11
         /rm_referee: /rm_referee died from signal 11
         /rm_referee: /rm_referee left a core dump
         /rm_referee: Determined pattern '/tmp/rosmon-node-hOWALc/core'
         /rm_referee: Could not find a matching core file :-(
▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂
```

```c
         /rm_referee: [Referee::unpack]: data length: 16, rx_data: 16
         /rm_referee: [Referee::unpack]: data length: 16, rx_data: 16
         /rm_referee: [Referee::unpack]: data length: 27, rx_data: 27
         /rm_referee: [Referee::unpack]: data length: 16, rx_data: 16
         /rm_referee: [Referee::unpack]: data length: 16, rx_data: 16
         /rm_referee: [Referee::unpack]: data length: 16, rx_data: 16
         /rm_referee: [Referee::unpack]: data length: 56587, rx_data: 11
         /rm_referee: /rm_referee died from signal 11
         /rm_referee: /rm_referee left a core dump
         /rm_referee: Determined pattern '/tmp/rosmon-node-hOWALc/core'
         /rm_referee: Could not find a matching core file :-(
▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂
```

但是，我们注意报错处，他们的值不一样了.

通过两次测试，都是在等于11时报错，且值一样

> 分析11的二进制：1011   56587的二进制: 1101110100001011



```c
第三次测试
         /rm_referee: [Referee::unpack]: data length: 27, rx_data: 27
         /rm_referee: [Referee::unpack]: data length: 16, rx_data: 16
         /rm_referee: [Referee::unpack]: data length: 27, rx_data: 27
         /rm_referee: [Referee::unpack]: data length: 16, rx_data: 16
         /rm_referee: [Referee::unpack]: data length: 27, rx_data: 27
         /rm_referee: [Referee::unpack]: data length: 42242, rx_data: 2
         /rm_referee: /rm_referee died from signal 11
         /rm_referee: /rm_referee left a core dump
         /rm_referee: Determined pattern '/tmp/rosmon-node-YYL5D0/core'
         /rm_referee: Could not find a matching core file :-(

```

> 分析2的二进制：10   42242的二进制:  1010010100000010

上面两次，1011对应1101110100001011的尾部4位，10对应1010010100000010的尾部2位



现在我怀疑是访问的问题了，data_length向前读了12位，总共获取了16位数据，即4个16进制位。

帧头应该是0xA5，即10100101，和上面两个数据不匹配，所以怀疑不成立。





现在我尝试将rx_data[0]也输出，这就是帧头数据，正常情况它应该是0xA5,即十进制165

```c
         /rm_referee: [Referee::unpack]: data length: 16, rx_data: 16, frame_head: 165
         /rm_referee: [Referee::unpack]: data length: 16, rx_data: 16, frame_head: 165
         /rm_referee: [Referee::unpack]: data length: 16, rx_data: 16, frame_head: 165
         /rm_referee: [Referee::unpack]: data length: 16, rx_data: 16, frame_head: 165
         /rm_referee: [Referee::unpack]: data length: 16, rx_data: 16, frame_head: 165
         /rm_referee: [Referee::unpack]: data length: 27, rx_data: 27, frame_head: 165
         /rm_referee: [Referee::unpack]: data length: 16, rx_data: 16, frame_head: 165
         /rm_referee: [Referee::unpack]: data length: 16, rx_data: 16, frame_head: 165
         /rm_referee: [Referee::unpack]: data length: 27, rx_data: 27, frame_head: 165
         /rm_referee: [Referee::unpack]: data length: 16, rx_data: 16, frame_head: 165
         /rm_referee: [Referee::unpack]: data length: 27, rx_data: 27, frame_head: 165
         /rm_referee: [Referee::unpack]: data length: 38400, rx_data: 0, frame_head: 165
         /rm_referee: /rm_referee died from signal 11
         /rm_referee: /rm_referee left a core dump
         /rm_referee: Determined pattern '/tmp/rosmon-node-4bD3ni/core'
         /rm_referee: Could not find a matching core file :-(

```

> 分析38400的二进制: 1001011000000000      0的二进制： 0

很明显，和前两次分析一样符合尾部相同



尝试读取frame_data的sof数据，正常情况下，它应该和头帧起始字节一样，为0xA5，即十进制165

```c
         /rm_referee: [Referee::unpack]: data length: 16, rx_data: 16, frame_sof: 165
         /rm_referee: [Referee::unpack]: data length: 16, rx_data: 16, frame_sof: 165
         /rm_referee: [Referee::unpack]: data length: 16, rx_data: 16, frame_sof: 165
         /rm_referee: [Referee::unpack]: data length: 16, rx_data: 16, frame_sof: 165
         /rm_referee: [Referee::unpack]: data length: 16, rx_data: 16, frame_sof: 165
         /rm_referee: [Referee::unpack]: data length: 16, rx_data: 16, frame_sof: 165
         /rm_referee: [Referee::unpack]: data length: 16, rx_data: 16, frame_sof: 165
         /rm_referee: [Referee::unpack]: data length: 16, rx_data: 16, frame_sof: 165
         /rm_referee: [Referee::unpack]: data length: 16, rx_data: 16, frame_sof: 165
         /rm_referee: [Referee::unpack]: data length: 27, rx_data: 27, frame_sof: 165
         /rm_referee: [Referee::unpack]: data length: 16, rx_data: 16, frame_sof: 165
         /rm_referee: [Referee::unpack]: data length: 27, rx_data: 27, frame_sof: 165
         /rm_referee: [Referee::unpack]: data length: 42242, rx_data: 2, frame_sof: 165
         /rm_referee: /rm_referee died from signal 11
         /rm_referee: /rm_referee left a core dump
         /rm_referee: Determined pattern '/tmp/rosmon-node-UAHhvP/core'
         /rm_referee: Could not find a matching core file :-(
```

帧头并没有问题，并且仍一样符合尾部相同。







看了串口协议后，我发现我漏了一点：储存data length的是uint16，是2个字节，单独rx_data[1]访问只有一个字节，现在我访问了rx_data[1]和rx_data[2]，这些都是data length 的数据位.

```c
    ROS_INFO("data length: %d, rx_data[1]: %d, rx_data[2]: %d", frame_header.data_length_, rx_data[1],rx_data[2]);
```



```c
         /rm_referee: [Referee::unpack]: data length: 16, rx_data[1]: 16, rx_data[2]: 0
         /rm_referee: [Referee::unpack]: data length: 16, rx_data[1]: 16, rx_data[2]: 0
         /rm_referee: [Referee::unpack]: data length: 16, rx_data[1]: 16, rx_data[2]: 0
         /rm_referee: [Referee::unpack]: data length: 16, rx_data[1]: 16, rx_data[2]: 0
         /rm_referee: [Referee::unpack]: data length: 16, rx_data[1]: 16, rx_data[2]: 0
         /rm_referee: [Referee::unpack]: data length: 16, rx_data[1]: 16, rx_data[2]: 0
         /rm_referee: [Referee::unpack]: data length: 16, rx_data[1]: 16, rx_data[2]: 0
         /rm_referee: [Referee::unpack]: data length: 16, rx_data[1]: 16, rx_data[2]: 0
         /rm_referee: [Referee::unpack]: data length: 27, rx_data[1]: 27, rx_data[2]: 0
         /rm_referee: [Referee::unpack]: data length: 16, rx_data[1]: 16, rx_data[2]: 0
         /rm_referee: [Referee::unpack]: data length: 27, rx_data[1]: 27, rx_data[2]: 0
         /rm_referee: [Referee::unpack]: data length: 16, rx_data[1]: 16, rx_data[2]: 0
         /rm_referee: [Referee::unpack]: data length: 27, rx_data[1]: 27, rx_data[2]: 0
         /rm_referee: [Referee::unpack]: data length: 16, rx_data[1]: 16, rx_data[2]: 0
         /rm_referee: [Referee::unpack]: data length: 16, rx_data[1]: 16, rx_data[2]: 0
         /rm_referee: [Referee::unpack]: data length: 42242, rx_data[1]: 2, rx_data[2]: 165
         /rm_referee: /rm_referee died from signal 11
         /rm_referee: /rm_referee left a core dump
         /rm_referee: Determined pattern '/tmp/rosmon-node-bzxHRX/core'
         /rm_referee: Could not find a matching core file :-(

```

```c
         /rm_referee: [Referee::unpack]: data length: 27, rx_data[1]: 27, rx_data[2]: 0
         /rm_referee: [Referee::unpack]: data length: 16, rx_data[1]: 16, rx_data[2]: 0
         /rm_referee: [Referee::unpack]: data length: 27, rx_data[1]: 27, rx_data[2]: 0
         /rm_referee: [Referee::unpack]: data length: 16, rx_data[1]: 16, rx_data[2]: 0
         /rm_referee: [Referee::unpack]: data length: 27, rx_data[1]: 27, rx_data[2]: 0
         /rm_referee: [Referee::unpack]: data length: 16, rx_data[1]: 16, rx_data[2]: 0
         /rm_referee: [Referee::unpack]: data length: 16, rx_data[1]: 16, rx_data[2]: 0
         /rm_referee: [Referee::unpack]: data length: 27, rx_data[1]: 27, rx_data[2]: 0
         /rm_referee: [Referee::unpack]: data length: 16, rx_data[1]: 16, rx_data[2]: 0
         /rm_referee: [Referee::unpack]: data length: 16, rx_data[1]: 16, rx_data[2]: 0
         /rm_referee: [Referee::unpack]: data length: 16, rx_data[1]: 16, rx_data[2]: 0
         /rm_referee: [Referee::unpack]: data length: 16, rx_data[1]: 16, rx_data[2]: 0
         /rm_referee: [Referee::unpack]: data length: 40515, rx_data[1]: 67, rx_data[2]: 158
         /rm_referee: /rm_referee died from signal 11
         /rm_referee: /rm_referee left a core dump

```

> 40515： 1001111001000011 与   67 ： 1000011  ，  158： 10011110

有意思的是，40515是先158再67组合出来的



```c
         /rm_referee: [Referee::unpack]: data length: 27, rx_data[0]: 165, rx_data[1]: 27, rx_data[2]: 0
         /rm_referee: [Referee::unpack]: data length: 16, rx_data[0]: 165, rx_data[1]: 16, rx_data[2]: 0
         /rm_referee: [Referee::unpack]: data length: 27, rx_data[0]: 165, rx_data[1]: 27, rx_data[2]: 0
         /rm_referee: [Referee::unpack]: data length: 16, rx_data[0]: 165, rx_data[1]: 16, rx_data[2]: 0
         /rm_referee: [Referee::unpack]: data length: 6, rx_data[0]: 165, rx_data[1]: 6, rx_data[2]: 0
         /rm_referee: [Referee::unpack]: data length: 16, rx_data[0]: 165, rx_data[1]: 16, rx_data[2]: 0
         /rm_referee: [Referee::unpack]: data length: 16, rx_data[0]: 165, rx_data[1]: 16, rx_data[2]: 0
         /rm_referee: [Referee::unpack]: data length: 16, rx_data[0]: 165, rx_data[1]: 16, rx_data[2]: 0
         /rm_referee: [Referee::unpack]: data length: 42242, rx_data[0]: 165, rx_data[1]: 2, rx_data[2]: 165
         /rm_referee: /rm_referee died from signal 11
         /rm_referee: /rm_referee left a core dump
         /rm_referee: Determined pattern '/tmp/rosmon-node-y93gzI/core'
         /rm_referee: Could not find a matching core file :-(
            [rosmon]: Shutting down...

```





最后试着屏蔽长帧来避免core dump

```c
    if(frame_header.data_length_ > 256)
    {
      ROS_INFO("data length: %d", frame_header.data_length_);
      return 0;
    }
```

被丢掉的数据：

```c
         /rm_referee: [RobotReferee::addUi]: time ui
         /rm_referee: [RobotReferee::addUi]: trigger ui
         /rm_referee: [RobotReferee::addUi]: fixed ui
         /rm_referee: [Referee::checkUiAdd]: Add ui
         /rm_referee: [Referee::unpack]: data length: 65296
         /rm_referee: [Referee::unpack]: data length: 65296
         /rm_referee: [Referee::unpack]: data length: 65296
         /rm_referee: [Referee::unpack]: data length: 4095
         /rm_referee: [Referee::unpack]: data length: 4095
         /rm_referee: [Referee::unpack]: data length: 65296
         /rm_referee: [Referee::unpack]: data length: 65296
         /rm_referee: [Referee::unpack]: data length: 65296
         /rm_referee: [Referee::unpack]: data length: 65296
         /rm_referee: [Referee::unpack]: data length: 42242
         /rm_referee: [Referee::unpack]: data length: 42242
         /rm_referee: [Referee::unpack]: data length: 42242
         /rm_referee: [Referee::unpack]: data length: 42242

```

**问题暂时性地解决**





##### 70HZ

```c
         /rm_referee: [Referee::unpack]: data length: 27
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 6
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 1
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 4
         /rm_referee: [Referee::unpack]: data length: 11
         /rm_referee: [Referee::unpack]: data length: 32
         /rm_referee: [Referee::unpack]: data length: 4
         /rm_referee: [Referee::unpack]: data length: 11
         /rm_referee: [Referee::unpack]: data length: 32
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 4
         /rm_referee: [Referee::unpack]: data length: 1
         /rm_referee: [Referee::unpack]: data length: 42242
         /rm_referee: /rm_referee died from signal 11
         /rm_referee: /rm_referee left a core dump
         /rm_referee: Determined pattern '/tmp/rosmon-node-1b1YjM/core'
         /rm_referee: Could not find a matching core file :-(

```





##### 100HZ

```c
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::read]: Port exception before read
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::read]: Port exception before read
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 27
         /rm_referee: [Referee::read]: Port exception before read
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 27
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::read]: Port exception before read
         /rm_referee: [Referee::unpack]: data length: 27
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::read]: Port exception before read
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::read]: Port exception before read
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 16
         /rm_referee: [Referee::unpack]: data length: 42242
         /rm_referee: /rm_referee died from signal 11
         /rm_referee: /rm_referee left a core dump
         /rm_referee: Determined pattern '/tmp/rosmon-node-hmmEkT/core'
         /rm_referee: Could not find a matching core file :-(

```

100hz下出现更多exception，我认为是读得太快了。不过在退出的时候，data length和40hz一样都是42242









## 裁判系统串口一段时间后无法读取

> 在hz为60时，一段时间后尝试读取串口会无法得到数据，同时minicom也没有信息。hz改为80后状况缓解



## 遥控器操纵：除了cover其他无法控制

> 在运行一段时间后，随机出现底盘，云台，左拨杆功能全部失去，仅在开右拨杆后功能恢复正常

本地manual debug后发现错误点，以下两处被反复调用，此时会处于ON OFF反复切换的状态

```c
  if (remote_is_open_ && (time - dbus_data_.stamp).toSec() > 0.3)
  {
    ROS_INFO("Remote controller OFF");
    remoteControlTurnOff();
    remote_is_open_ = false;
  }
  if (!remote_is_open_ && (time - dbus_data_.stamp).toSec() < 0.3)
  {
    ROS_INFO("Remote controller ON");
    remoteControlTurnOn();
    remote_is_open_ = true;
  }
```



**关于为什么开右拨杆后功能恢复正常**

一个循环调用的函数会独立检查右拨杆

```c
 //void ManualBase::checkSwitch(const ros::Time& time)下
right_switch_down_event_.update(dbus_data_.s_r == rm_msgs::DbusData::DOWN);
  right_switch_mid_event_.update(dbus_data_.s_r == rm_msgs::DbusData::MID);
  right_switch_up_event_.update(dbus_data_.s_r == rm_msgs::DbusData::UP);
```



经测试dbus的接收正常(所以还能读右拨杆)

稳定触发该bug的方法：找一条语句打上断点后执行几次，使dbus_data的stamp和time有差值后，就进入无法操控模式



- 一个想法是，dbus的数据订阅者的队列有10，这个值较长，可能会导致新dbus数据延后，导致延时if判断生效，进入remoteControlTurnOff(); 在新的dbus来后，又满足了延时刷新，触发了remoteControlTurnOn();







# 不算虫的虫

> 代码规范上的事



### POWER_LIMIT赋值

> 在对power_limit的referee_data消除的工作中，需要补加需要的数据，原本是在powet_limit类里面加上msgs的变量，然后通过回调按值赋值。后在在凯子的建议下改称指针且仅在构造时赋值。虽然我的代码是能跑的，但是很显然非常不规范且不简洁。

**总结：尽量使用引用或指针**





# 码一个

## 暑假修改referee

**类型转换**

```c++
//最危险的是：
reinterpret_cast<uint8_t*>(地址不知道会不会影响到(uint8_t*)原来的功能
    
const_cast<uint8_t*>(指针变量)也是
```

